<input id="photo" type="file" />
<div id="results"></div>

<script type="module">
  import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

  (async () => {
    const client = await Client.connect("sbe2324/catdognick");
    console.log(await client.view_api());

    const photo   = document.getElementById("photo");
    const results = document.getElementById("results");

    photo.addEventListener("change", async () => {
      const file = photo.files[0];
      if (!file) return;

        try {
        // call predict
        const resp = await client.predict("/predict", { img: file });

        // pull out the confidences array
        const confs = resp.data[0].confidences;
        // look up each by label
        const dogProb = confs.find(c => c.label === "Dog")?.confidence ?? 0;
        const catProb = confs.find(c => c.label === "Cat")?.confidence ?? 0;

        // render neatly
        results.innerHTML = `
          <img src="${URL.createObjectURL(file)}" width="300">
            <br>
            <br>
            Sam says:
            <br>
            <br>
            I am ${(dogProb*100).toFixed(2)}% confident this is a dog. 
            <br>
            <br>
            I am ${(catProb*100).toFixed(2)}% confident this is a cat.
        `;
          // Add this after results.innerHTML = ... in your event listener
          function confetti() {
            for (let i = 0; i < 100; i++) {
              const div = document.createElement('div');
              div.style.position = 'fixed';
              div.style.left = Math.random() * 100 + 'vw';
              div.style.top = '-10px';
              div.style.width = '8px';
              div.style.height = '8px';
              div.style.background = `hsl(${Math.random()*360},100%,50%)`;
              div.style.borderRadius = '50%';
              div.style.zIndex = 9999;
              document.body.appendChild(div);
              let fall = setInterval(() => {
                div.style.top = (parseFloat(div.style.top) + 5) + 'px';
                if (parseFloat(div.style.top) > window.innerHeight) {
                  clearInterval(fall);
                  div.remove();
                }
              }, 16);
            }
          }
          confetti();
          // Play sound based on confidence
          // Use a different sound for each animal
          let audio;
          if (dogProb > .5) {
            audio = new Audio('https://www.myinstants.com/media/sounds/deepbark.mp3');
            audio.play();
            results.innerHTML += `<p style="color:blue">üê∂ Woof!</p>`;
          }
          else if (catProb > .5) {
            audio = new Audio('https://www.myinstants.com/media/sounds/meow-1.mp3');
            audio.play();
            results.innerHTML += `<p style="color:red">üê± Meow!</p>`;
          }
          else
            results.innerHTML += `<p style="color:orange">ü§î What the heck!</p>`;
          // Add rotation effect on hover
          const img = results.querySelector('img');
          img.style.transition = 'transform 0.5s';
          img.onmouseover = () => img.style.transform = 'rotate(20deg) scale(1.1)';
          img.onmouseout  = () => img.style.transform = '';
      } catch(err) {
        console.error("‚ùå Gradio predict error:", err.original_msg || err);
        results.innerHTML = `<p style="color:red">Error: ${err.original_msg||err}</p>`;
      }
    });
  })();
</script>